/* eslint-disable */
var SubtitlesOctopus=function(e){var t,r=this;function a(){r.ctx.putImageData(new ImageData(r.renderFrameData,r.canvas.width,r.canvas.height),0,0),r.renderFrameData=null}function n(){var e=r.renderFramesData,t=performance.now();r.ctx.clearRect(0,0,r.canvas.width,r.canvas.height);for(var a=0;a<e.canvases.length;a++){var n=e.canvases[a];r.bufferCanvas.width=n.w,r.bufferCanvas.height=n.h;var o=new Uint8ClampedArray(n.buffer),s=new ImageData(o,n.w,n.h);r.bufferCanvasCtx.putImageData(s,0,0),r.ctx.drawImage(r.bufferCanvas,n.x,n.y)}if(r.debug){var i=Math.round(performance.now()-t);console.log(Math.round(e.spentTime)+" ms (+ "+i+" ms draw)"),r.renderStart=performance.now()}}r.canvas=e.canvas,r.isOurCanvas=!1,r.video=e.video,r.canvasParent=null,r.fonts=e.fonts||[],r.availableFonts=e.availableFonts||[],r.onReadyEvent=e.onReady,r.workerUrl=e.workerUrl||"libassjs-worker.js",r.subUrl=e.subUrl,r.subContent=e.subContent||null,r.onErrorEvent=e.onError,r.debug=e.debug||!1,r.lastRenderTime=0,r.pixelRatio=window.devicePixelRatio||1,r.timeOffset=e.timeOffset||0,"function"!=typeof ImageData.prototype.constructor&&(t=document.createElement("canvas").getContext("2d"),window.ImageData=function(){var e=0;if(arguments[0]instanceof Uint8ClampedArray)var r=arguments[e++];var a=arguments[e++],n=arguments[e],o=t.createImageData(a,n);return r&&o.data.set(r),o}),r.workerError=function(e){if(console.error("Worker error: ",e),r.onErrorEvent&&r.onErrorEvent(e),!r.debug)throw r.dispose(),new Error("Worker error: "+e)},r.init=function(){window.Worker?(r.worker||(r.worker=new Worker(r.workerUrl),r.worker.onmessage=r.onWorkerMessage,r.worker.onerror=r.workerError),r.workerActive=!1,r.createCanvas(),r.setVideo(e.video),r.setSubUrl(e.subUrl),r.worker.postMessage({target:"worker-init",width:r.canvas.width,height:r.canvas.height,URL:document.URL,currentScript:r.workerUrl,preMain:!0,subUrl:r.subUrl,subContent:r.subContent,fonts:r.fonts,availableFonts:r.availableFonts})):r.workerError("worker not supported")},r.createCanvas=function(){r.canvas||(r.video?(r.isOurCanvas=!0,r.canvas=document.createElement("canvas"),r.canvas.className="libassjs-canvas",r.canvas.style.display="none",r.canvasParent=document.createElement("div"),r.canvasParent.className="libassjs-canvas-parent",r.canvasParent.appendChild(r.canvas),r.video.nextSibling?r.video.parentNode.insertBefore(r.canvasParent,r.video.nextSibling):r.video.parentNode.appendChild(r.canvasParent)):r.canvas||r.workerError("Don't know where to render: you should give video or canvas in options.")),r.ctx=r.canvas.getContext("2d"),r.bufferCanvas=document.createElement("canvas"),r.bufferCanvasCtx=r.bufferCanvas.getContext("2d")},r.setVideo=function(e){if(r.video=e,r.video){var t=function(){r.setCurrentTime(e.currentTime+r.timeOffset)};r.video.addEventListener("timeupdate",t,!1),r.video.addEventListener("playing",function(){r.setIsPaused(!1,e.currentTime+r.timeOffset)},!1),r.video.addEventListener("pause",function(){r.setIsPaused(!0,e.currentTime+r.timeOffset)},!1),r.video.addEventListener("seeking",function(){r.video.removeEventListener("timeupdate",t)},!1),r.video.addEventListener("seeked",function(){r.video.addEventListener("timeupdate",t,!1),r.setCurrentTime(e.currentTime+r.timeOffset)},!1),r.video.addEventListener("ratechange",function(){r.setRate(e.playbackRate)},!1),r.video.addEventListener("timeupdate",function(){r.setCurrentTime(e.currentTime+r.timeOffset)},!1),r.video.addEventListener("waiting",function(){r.setIsPaused(!0,e.currentTime+r.timeOffset)},!1),document.addEventListener("fullscreenchange",r.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",r.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",r.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",r.resizeWithTimeout,!1),window.addEventListener("resize",r.resizeWithTimeout,!1),"undefined"!=typeof ResizeObserver&&(r.ro=new ResizeObserver(r.resizeWithTimeout),r.ro.observe(r.video)),r.video.videoWidth>0?r.resize():r.video.addEventListener("loadedmetadata",function(e){e.target.removeEventListener(e.type,arguments.callee),r.resize()},!1)}},r.getVideoPosition=function(){var e=r.video.videoWidth/r.video.videoHeight,t=r.video.offsetWidth,a=r.video.offsetHeight,n=t,o=a;return t/a>e?n=Math.floor(a*e):o=Math.floor(t/e),{width:n,height:o,x:(t-n)/2,y:(a-o)/2}},r.setSubUrl=function(e){r.subUrl=e},r.cloneObject=function(e){var t={};for(var r in e)if(r!=r.toUpperCase()){var a=e[r];"number"!=typeof a&&"string"!=typeof a||(t[r]=a)}return t},r.renderFrameData=null,r.workerActive=!1,r.frameId=0,r.onWorkerMessage=function(e){r.workerActive||(r.workerActive=!0,r.onReadyEvent&&r.onReadyEvent());var t=e.data;switch(t.target){case"stdout":console.log(t.content);break;case"stderr":console.error(t.content);break;case"window":window[t.method]();break;case"canvas":switch(t.op){case"getContext":r.ctx=r.canvas.getContext(t.type,t.attributes);break;case"resize":r.resize(t.width,t.height);break;case"render":r.renderFrameData||window.requestAnimationFrame(a),t.buffer?r.renderFrameData=new Uint8ClampedArray(t.buffer):r.renderFrameData=t.image.data;break;case"renderMultiple":r.lastRenderTime<t.time&&(r.lastRenderTime=t.time,r.renderFramesData=t,window.requestAnimationFrame(n));break;case"setObjectProperty":r.canvas[t.object][t.property]=t.value;break;default:throw"eh?"}break;case"tick":r.frameId=t.id,r.worker.postMessage({target:"tock",id:r.frameId});break;case"Image":assert("src"===t.method);var o=new Image;o.onload=function(){assert(o.complete);var e=document.createElement("canvas");e.width=o.width,e.height=o.height;var a=e.getContext("2d");a.drawImage(o,0,0);var n=a.getImageData(0,0,o.width,o.height);r.worker.postMessage({target:"Image",method:"onload",id:t.id,width:o.width,height:o.height,data:n.data,preMain:!0})},o.onerror=function(){r.worker.postMessage({target:"Image",method:"onerror",id:t.id,preMain:!0})},o.src=t.src;break;case"custom":if(!r.onCustomMessage)throw"Custom message received but client onCustomMessage not implemented.";r.onCustomMessage(e);break;case"setimmediate":r.worker.postMessage({target:"setimmediate"});break;default:throw"what? "+t.target}},r.resize=function(e,t,a,n){var o=null;if(a=a||0,n=n||0,(!e||!t)&&r.video){e=(o=r.getVideoPosition()).width*r.pixelRatio,t=o.height*r.pixelRatio;var s=r.canvasParent.getBoundingClientRect().top-r.video.getBoundingClientRect().top;a=o.y-s,n=o.x}e&&t?r.canvas.width==e&&r.canvas.height==t&&r.canvas.style.top==a&&r.canvas.style.left==n||(r.canvas.width=e,r.canvas.height=t,null!=o&&(r.canvasParent.style.position="relative",r.canvas.style.display="block",r.canvas.style.position="absolute",r.canvas.style.width=o.width+"px",r.canvas.style.height=o.height+"px",r.canvas.style.top=a+"px",r.canvas.style.left=n+"px",r.canvas.style.pointerEvents="none"),r.worker.postMessage({target:"canvas",width:r.canvas.width,height:r.canvas.height})):r.video||console.error("width or height is 0. You should specify width & height for resize.")},r.resizeWithTimeout=function(){r.resize(),setTimeout(r.resize,100)},r.runBenchmark=function(){r.worker.postMessage({target:"runBenchmark"})},r.customMessage=function(e,t){t=t||{},r.worker.postMessage({target:"custom",userData:e,preMain:t.preMain})},r.setCurrentTime=function(e){r.worker.postMessage({target:"video",currentTime:e})},r.setTrackByUrl=function(e){r.worker.postMessage({target:"set-track-by-url",url:e})},r.setTrack=function(e){r.worker.postMessage({target:"set-track",content:e})},r.freeTrack=function(e){r.worker.postMessage({target:"free-track"})},r.render=r.setCurrentTime,r.setIsPaused=function(e,t){r.worker.postMessage({target:"video",isPaused:e,currentTime:t})},r.setRate=function(e){r.worker.postMessage({target:"video",rate:e})},r.dispose=function(){r.worker.postMessage({target:"destroy"}),r.worker.terminate(),r.workerActive=!1,r.video&&r.video.parentNode.removeChild(r.canvasParent)},r.init()};"function"==typeof SubtitlesOctopusOnLoad&&SubtitlesOctopusOnLoad();
export { SubtitlesOctopus }
